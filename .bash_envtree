#!/bin/bash
# 啟用專屬命令行介面


if [ ! -d "$HOME/.ys" ]; then
    sh "`dirname "$0"`/_userdir/.myBash/envtree_init.sh"
else
    myBash() {
        local txt idx len val


        ## nvm

        export NVM_DIR="$HOME/.nvm"
        [ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"  # This loads nvm
        [ -s "$NVM_DIR/bash_completion" ] && . "$NVM_DIR/bash_completion"  # This loads nvm bash_completion


        ## myBash

        local myBashDir cmdPlatformCode
        local platformEnv method
        myBashDir=$HOME/.myBash

        case `uname` in
            *CYGWIN* ) cmdPlatformCode=2 ;; # Cygwin
            * )        cmdPlatformCode=1 ;; # Linux
        esac

        txt=`cat "$myBashDir/.myProFile" | sed "s/#.*//g" | grep "."`
        len=`echo -e "$txt" | wc -l`

        for idx in `seq 1 $len`
        do
            val=`echo -e "$txt" | sed -n "${idx}p"`
            platformEnv=`echo "$val" | cut -d " " -f 1`
            method=`     echo "$val" | cut -d " " -f 2`
            val=`        echo "$val" | cut -d " " -f 3-`

            case $platformEnv in
                3 ) platformEnv="1 2" ;;
            esac
            if [ -z "`echo " $platformEnv " | grep " $cmdPlatformCode "`" ]; then continue; fi

            case $method in
                PATH )
                    val=`realpath "$HOME/ys/$val"`
                    if [ -z "`echo $PATH | grep "\(^\|:\)$val\(:\|$\)"`" ]; then
                        PATH="$PATH:$val"
                    fi
                    ;;
                SOURCE )
                    source $myBashDir/$val
                    ;;
            esac
        done
    }

    myBash
fi

